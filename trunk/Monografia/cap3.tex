\chapter{Modelo proposto}\label{cap:som}

Este capítulo descreve a prova de conceito proposta neste trabalho. Será detalhado o algoritmo desenvolvido, bem como detalhes de sua implementação e o funcionamento do mesmo.

\section{Visão Geral}
O modelo para recomendação desenvolvido leva em consideração a limitação de vídeo locadoras no que tange aos conceitos gerais de sistemas de recomendação comuns. As informações que estão disponíveis num ambiente de locadora de filmes consideram somente o cliente como indivíduo e não um grupo de clientes que podem contribuir juntamente para gerar recomendações. Portanto não há o conceito de avaliação de um item pelo usuário. Nos sistemas de locadoras comuns não existe um mecanismo onde o cliente possa dar sua nota para um filme de forma que outros clientes possam acompanhar essas avaliações e ter um parâmetro para a escolha de determinado título. Existe apenas a opinião presencial de clientes que queiram expressá-las ou quando o funcionário da loja educadamente questiona sobre a satisfação do cliente com relação a determinado filme. Nenhuma informação é armazenada num banco de dados, nem é realizado um levantamento das opiniões de diversos clientes, com o propósito de identificar os melhores filmes.

A proposta deste trabalho é desenvolver um sistema que, baseado no histórico de locações de um cliente, ele possa auxiliar a condução do processo de uma escolha satisfatória no momento de locar um novo título. O sistema se baseia unicamente no conteúdo de informação acerca dos filmes que já foram locados por um determinado cliente, informações essas que podem ser facilmente obtidas no banco de dados da locadora. Como mencionado anteriormente, não existem avaliações de clientes sobre os filmes nem parâmetros que determinem as preferências desses clientes. Portanto, o modelo proposto não ambiciona gerar uma lista de recomendações diretas com títulos para o cliente, apenas auxiliá-lo de forma a realizar uma escolha consciente baseado nas informações contidas nos filmes. O modelo utiliza redes auto-organizáveis, pois este algoritmo desempenha bem a função de agrupamento e vizinhança, para que o cliente tenha uma percepção melhor da relação entre os filmes que já assistiu com os que deseja locar atualmente. O objetivo específico do trabalho é realizar uma prova de conceito para o uso de redes SOM na recomendação de filmes a ser implementado em vídeo locadoras como forma de personalização da loja para o cliente, tornando mais prazeroso e simplificado o ato da escolha do filme a ser locado. A personalização, como comentado anteriormente, torna o cliente mais satisfeito e mais assíduo.

O modelo proposto consiste em uma rede SOM que, quando treinada, é composta por filmes contidos no histórico de um cliente (topologicamente organizados). Propomos então, um mapa SOM para cada cliente; e não um mapa só para toda a locadora. Essa decisão de projeto respeita a personalização, objetivo principal deste trabalho. A rede irá distribuir os títulos no mapa bidimensional, agrupando-os de acordo com semelhanças entre informações fornecidas sobre os filmes. Nesta fase ocorre o aprendizado do comportamento do cliente com relação às escolhas de filmes. 

Após o treinamento da rede, os filmes locados por um cliente estarão distribuídos no mapa. O cliente deve, então selecionar um filme do acervo da locadora e apresentar ao seu mapa individual. A rede irá calcular a posição deste novo filme e irá mostrar ao usuário três filmes que estejam próximos ao primeiro, determinando que há semelhanças entre esses quatro títulos. Esta é uma forma de auxiliar o cliente, pois ele pode avaliar se irá gostar ou não do filme, partindo da satisfação que teve ao assistir os outros três. A Figura \ref{fluxo_modelo} mostra o fluxo básico da execução do sistema.

A ferramenta foi modelada de forma a se integrar ao sistema de informação da vídeo locadora com o objetivo de ser um diferencial da locadora para corresponder à demanda dos clientes na busca de informações que os auxiliem no processo de escolha e locação de novos filmes. O projeto proposto, então, não pretende realizar o gerenciamento do estabelecimento como um todo.


\begin{figure}[htbp]
	\centering
		\includegraphics[width=0.30\textwidth]{imagens/fluxo_modelo.JPG}
	\caption{Fluxo de execução do modelo proposto}
	\label{fluxo_modelo}
\end{figure}


\section{Implementação do modelo}
A implementação da rede SOM utilizada no modelo deste trabalho foi feita baseada no algoritmo original proposto por Kohonen, como descrito no Capítulo 2. A linguagem utilizada para desenvolvimento foi C\# com o \reg{Microsoft} \reg{Visual Studio} 2008 como IDE (\emph{Integrated Development Environment} ou Ambiente Integrado de Desenvolvimento) de programação. A escolha desta tecnologia se justifica por ser uma linguagem de fácil implementação e ser mais largamente utilizada pelo autor deste trabalho. A Figura \ref{DiagramaClasses} mostra os diagramas de classes do modelo implementado. MapaSOM é uma classe que comporta todos os neurônio da rede e recebe o conjunto de entradas para ser apresentado durante o treinamento. Cada neurônio possui coordenadas $x$ e $y$, determinando sua posição no reticulado do mapa e o vetor de pesos que são inicializados aleatoriamente e ajustados durante a fase de aprendizado. Cada padrão de entrada tem um conjunto de características que são extraídos do banco de dados de filmes, além de um objeto neurônio que caracteriza o neurônio vencedor para representar o padrão.

\begin{figure}[htbp]
	\centering
		\includegraphics[width=1.00\textwidth]{../DiagramaClasses.jpg}
	\caption{Diagrama de classes do modelo}
	\label{DiagramaClasses}
\end{figure}

A Figura \ref{sequenciaTreinamento} mostra o diagrama de seqüência do programa durante a fase de treinamento. O treinamento inicia criando um mapa com um determinado número de neurônios, cujos pesos são inicializados com valores aleatórios. Após a fase de inicialização do mapa, tem início o algoritmo de aprendizado propriamente dito. Então são apresentados os padrões de entrada que representam os filmes presentes no histórico do cliente e, para cada um deles, é selecionado o neurônio que melhor representa uma dada entrada. Este neurônio tem seus pesos atualizados de forma a melhor refletir as características da entrada. O neurônios contidos no raio de vizinhança do neurônio vencedor também têm seus pesos atualizados. Assim que todos os padrões de entrada, ou seja, todos os títulos do histórico, forem apresentados, é iniciado um novo ciclo de treinamento. Quando o número de ciclos atingir um determinado limite, o treinamento é encerrado. O valor do limite de ciclos segue o valor proposto por Kohonen, como mencionado na seção \ref{treinamento_som}.

\begin{figure}[htbp]
	\centering
		\includegraphics[width=0.70\textwidth]{imagens/sequenciaTreinamento.png}
	\caption{Diagrama de seqüência da fase de treinamento}
	\label{sequenciaTreinamento}
\end{figure}

\section{Funcionamento do modelo}

O algoritmo inicia obtendo os padrões de entrada a serem utilizados na fase de treinamento, que são os filmes do histórico de locações do cliente. A ferramenta extrai os títulos dos filmes locados pelo cliente e busca no acervo da locadora as informações complementares para cada título. Essas informações serão utilizadas como vetor de entrada para cada padrão de entrada durante a  fase de aprendizado da rede. Logo em seguida é determinado o tamanho do mapa, ou seja, o número de neurônios presentes na rede. O vetor de pesos de cada um desses neurônios é inicializado com valores aleatórios e é determinado o raio de vizinhança inicial. Empiricamente, um valor inicial adequado para a vizinhança é de 60\% do tamanho total do mapa.

Após a fase de inicialização do mapa, segue-se a fase de aprendizado ou treinamento. A fase de treinamento inicia ao serem apresentados à rede os padrões de entrada. Cada padrão de entrada possui um vetor de características que identifica unicamente um filme. Então é calculado o neurônio que mais se aproxima de cada padrão, denominado como neurônio vencedor. O cálculo para determinar o neurônio vencedor segue a função da distância euclidiana como descrito na seção \ref{treinamento_som} pela equação \ref{dist_euclid}. Este cálculo é realizado através da distância euclidiana entre o vetor de características de um padrão de entrada e o vetor de pesos de um neurônio. Quanto mais similar um neurônio for de uma entrada menor será a distância entre os dois, caracterizando o neurônio vencedor. 

Os pesos do neurônio selecionado são atualizados, assim como os pesos de neurônios em seu raio de vizinhança. Como dito anteriormente o raio de vizinhança inicial é igual a 60\% do tamanho do mapa, esse raio é decrescido monotonicamente segundo a equação \ref{gaussiana} mostrada na seção \ref{treinamento_som}. Esses passos são repetidos até que o número determinado de ciclos seja alcançado. No final da fase de treinamento todos os filmes presentes no histórico do cliente estão distribuídos topologicamente no mapa que representa, então, o perfil do usuário.

Com a rede treinada, inicia-se a fase de teste. Neste passo serão mostrados novos títulos de filmes à rede, representando filmes que o cliente deseja alugar. Ao ser apresentado a um novo padrão, a rede irá calcular o neurônio que melhor representa este padrão, da mesma maneira que é realizado na fase de aprendizado. A diferença aqui está em que os pesos do neurônio vencedor não serão mais ajustados, ele é apenas selecionado como representante daquela entrada no mapa topológico do perfil do cliente. O ajuste de pesos é que caracteriza o aprendizado da rede, portanto nesta fase não é realizado o cálculo de ajuste e de vizinhança.

Após o cálculo do neurônio vencedor para o novo filme, o algoritmo irá determinar quais são os três neurônios mais próximos daquele. Para isso é calculada a distância entre dois pontos no plano bidimensional. Os três neurônios mais próximos do vencedor representam padrões de entrada que são os filmes que mais se assemelham ao filme representado pelo neurônio vencedor. O sistema então auxilia o cliente na decisão mostrando que o filme que ele deseja locar tem relação de semelhança com outros três que ele já locou no passado. Dependendo da satisfação do usuário com os três filmes que foram mostrados, ele decide se irá mesmo locar o filme escolhido ou não. Prover a informação da relação entre os filmes agrega confiança ao sistema, pois o cliente saberá a origem das recomendações apresentadas.

Para visualização do mapa, a ferramenta cria um gráfico bidimensional plotando os filmes do histórico e os novos filmes que o cliente deseja locar. As Figuras \ref{mapa_cliente1} e \ref{mapa_cliente2} mostram exemplos desse gráfico para o cliente 1 e cliente 2, respectivamente. Cada ponto do gráfico representa um neurônio contido no mapa que foi construído na fase de treinamento. Os pontos de cor laranja representam os títulos presentes no histórico do cliente, os pontos de cor vermelha são os novos filmes que o cliente deseja locar e os de cor azul são pontos que não representam nenhum filme. Navegando pelo mapa o cliente pode aproximar o \emph{mouse} a um dos pontos e será mostrado um \emph{tootip} (legenda) contendo o título do filme que o ponto representa, desta forma o cliente pode procurar os filmes que estão mais próximos dos novos filmes. 

Os gráficos apresentados foram criados utilizando a ferramenta \emph{Visifire}, que cria gráficos utilizando a tecnologia WPF (Windows Presentation Foundation) presente na plataforma .NET da \reg{Microsoft}. O WPF é um subsistema gráfico do .NET Framework, ou seja é uma tecnologia que permite a criação de interfaces de apresentação para aplicativos desenvolvidos sob a plataforma .NET.

\begin{figure}[htbp]
	\centering
		\includegraphics[width=1.00\textwidth]{imagens/mapa_cliente1.JPG}
	\caption{Mapa de filmes do cliente 1}
	\label{mapa_cliente1}
\end{figure}


\begin{figure}[htbp]
	\centering
		\includegraphics[width=1.00\textwidth]{imagens/mapa_cliente2.JPG}
	\caption{Mapa de filmes do cliente 2}
	\label{mapa_cliente2}
\end{figure}

A nível de experimentos e avalização de resultados, foram gerados arquivos de texto contendo as informações dos novos filmes e dos três filmes que mais se assemelham a eles. Estes experimentos serão detalhados no Capítulo \ref{resultados}.